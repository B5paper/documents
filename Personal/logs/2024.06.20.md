* console 模式下可以运行的安装命令：

    ```
    hlc@hlc-VirtualBox:/home/libvirt-qemu$ virt-install --name aaa --memory 2048 --vcpus 2 --disk size=20 --location https://mirror.sjtu.edu.cn/ubuntu/dists/focal/main/installer-amd64/ --os-variant ubuntu22.04 --nographics -x 'console=ttyS0'
    ```

    注：

    * `--cdrom`默认没有 console 输出，因此只能用于图形系统。`--location`可以设置 console 输出，因此可以在文字操作系统下安装一些 live server 版的系统。

    * 这个命令中的`--location`选用了 network url，目前可以正常安装。ubuntu focal 是最后一版可以通过 url 安装的 ubuntu 系统，下个版本 jammy 已经不支持了。

    * `-x 'console=ttyS0'`与`--location`搭配使用可以让输出重定向到 console。

    * `--location`的参数改成 iso 时，会报错目录错误。如果将 iso 先 mount 到本地目录，再使用 mount 的目录进行安装，那么会最终进入到 initramfs 中，无法找到可以挂载的磁盘 dev。

    * 网上的大部分方案，在使用`--location` + iso 时，都是用的 centos 镜像，所以很有可能 centos 的 iso 可以通过`--location`安装成功。但是为什么 ubuntu 的 iso 不行，不清楚。有时间了可以去看下 virt-manager 的开源代码实现：<https://github.com/virt-manager/virt-manager>

* 关闭一个虚拟机：`virsh destroy aaa`

* 删除一个虚拟机，并且删除 virtual disk image: `virsh undefine aaa --remove-all-storage`

* windows 上 virtual box 无法启动嵌套 kvm 解决方法

    ```powershell
    PS C:\Users\hlc\VirtualBox VMs> D:\Softwares\VirtualBox\VBoxManage.exe list vms
    ```

    output:

    ```
    "Ubuntu 20.04" {d8054d31-1c97-4ec1-946f-da7246cb03f4}
    "Ubuntu_2204" {86b4978b-45f8-40ff-848f-6094d1d89560}
    "Ubuntu_2204 _origin" {041fad56-26f1-4505-9f11-79098883357f}
    ```

    modify the vm nested virtualization feature:

    ```powershell
    PS C:\Users\hlc\VirtualBox VMs> D:\Softwares\VirtualBox\VBoxManage.exe modifyvm "Ubuntu_2204 _origin" --nested-hw-virt on
    ```

    运行后可以看到 vm 管理界面里嵌套虚拟化的对勾 v 已经开启了。

    此时进入虚拟机，运行`lsmod | grep kvm`可以看到

    ```
    kvm_intel       487424  0
    kvm            1409024  1 kvm_intel
    irqbypass        12288  1 kvm
    ```

    说明虚拟机中 kvm 启动成功。

* 换完 kernel 后不显示桌面，很有可能是`gdm3`的问题

    目前一个碰巧可行的修复办法是`sudo apt install lightdm`，然后在安装时有个选项，选择`gdm3`。再重启，桌面就正常了。不清楚原理。