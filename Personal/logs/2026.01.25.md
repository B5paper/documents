* ç®€è¿° python å¤„ç† csv æ–‡ä»¶çš„æ–¹æ³•

    Pythonå¤„ç†CSVæ–‡ä»¶çš„å¸¸ç”¨æ–¹æ³•ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š

    1. ä½¿ç”¨csvæ¨¡å—ï¼ˆæ ‡å‡†åº“ï¼‰

        åŸºæœ¬è¯»å†™æ“ä½œ

        ```python
        import csv

        # è¯»å–CSVæ–‡ä»¶
        with open('data.csv', 'r', encoding='utf-8') as file:
            reader = csv.reader(file)
            for row in reader:
                print(row)

        # è¯»å–ä¸ºå­—å…¸æ ¼å¼
        with open('data.csv', 'r', encoding='utf-8') as file:
            reader = csv.DictReader(file)
            for row in reader:
                print(row['column_name'])

        # å†™å…¥CSVæ–‡ä»¶
        data = [['Name', 'Age'], ['Alice', 25], ['Bob', 30]]
        with open('output.csv', 'w', newline='', encoding='utf-8') as file:
            writer = csv.writer(file)
            writer.writerows(data)
        ```

    2. ä½¿ç”¨pandasåº“ï¼ˆæœ€å¸¸ç”¨ï¼‰

        ```python
        import pandas as pd

        # è¯»å–CSV
        df = pd.read_csv('data.csv')
        print(df.head())  # æŸ¥çœ‹å‰å‡ è¡Œ
        print(df.info())  # æŸ¥çœ‹æ•°æ®ä¿¡æ¯

        # æ•°æ®å¤„ç†
        df['new_column'] = df['old_column'] * 2  # æ–°å¢åˆ—
        filtered_df = df[df['age'] > 25]         # è¿‡æ»¤æ•°æ®
        grouped = df.groupby('category').mean()   # åˆ†ç»„èšåˆ

        # å†™å…¥CSV
        df.to_csv('output.csv', index=False, encoding='utf-8')
        ```

    3. ä½¿ç”¨numpyåº“ï¼ˆæ•°å€¼æ•°æ®å¤„ç†ï¼‰

        ```python
        import numpy as np

        # è¯»å–æ•°å€¼æ•°æ®
        data = np.genfromtxt('data.csv', delimiter=',', skip_header=1)
        # æˆ–
        data = np.loadtxt('data.csv', delimiter=',', skiprows=1)

        # å¤„ç†æ•°å€¼æ•°æ®
        mean_values = np.mean(data, axis=0)
        ```

    4. ä½¿ç”¨å†…ç½®openå‡½æ•°ï¼ˆç®€å•æƒ…å†µï¼‰

        ```python
        # ç®€å•è¯»å–
        with open('data.csv', 'r', encoding='utf-8') as f:
            for line in f:
                columns = line.strip().split(',')
                print(columns)

        # ç®€å•å†™å…¥
        data = [['Name', 'Age'], ['Alice', '25']]
        with open('output.csv', 'w', encoding='utf-8') as f:
            for row in data:
                f.write(','.join(map(str, row)) + '\n')
        ```

    å¸¸ç”¨å‚æ•°è¯´æ˜

    pandasè¯»å–å‚æ•°ï¼š

    * sep / delimiter: åˆ†éš”ç¬¦ï¼ˆé»˜è®¤','ï¼‰

    * header: æŒ‡å®šè¡¨å¤´è¡Œï¼ˆé»˜è®¤0ï¼‰

    * index_col: æŒ‡å®šç´¢å¼•åˆ—

    * usecols: æŒ‡å®šè¯»å–çš„åˆ—

    * dtype: æŒ‡å®šåˆ—æ•°æ®ç±»å‹

    * na_values: æŒ‡å®šç¼ºå¤±å€¼è¡¨ç¤º

    * encoding: æ–‡ä»¶ç¼–ç ï¼ˆå¦‚'utf-8'ã€'gbk'ï¼‰

    å†™å…¥å‚æ•°ï¼š

    * index: æ˜¯å¦å†™å…¥ç´¢å¼•ï¼ˆé»˜è®¤Trueï¼‰

    * columns: æŒ‡å®šå†™å…¥çš„åˆ—

    * encoding: è¾“å‡ºç¼–ç 

    é€‰æ‹©å»ºè®®

    * ç®€å•æ“ä½œ â†’ ä½¿ç”¨csvæ¨¡å—

    * æ•°æ®åˆ†æå’Œå¤æ‚å¤„ç† â†’ ä½¿ç”¨pandasï¼ˆæ¨èï¼‰

    * çº¯æ•°å€¼æ•°æ®å¤„ç† â†’ ä½¿ç”¨numpy

    * å¤§æ–‡ä»¶å¤„ç† â†’ ä½¿ç”¨csvæ¨¡å—æˆ–pandasçš„chunksizeå‚æ•°

    * å†…å­˜é™åˆ¶ â†’ ä½¿ç”¨csvæ¨¡å—é€è¡Œå¤„ç†

    å¤„ç†å¤§æ–‡ä»¶ç¤ºä¾‹

    ```python
    # pandasåˆ†å—è¯»å–
    chunk_size = 10000
    for chunk in pd.read_csv('large_file.csv', chunksize=chunk_size):
        process(chunk)  # é€å—å¤„ç†

    # csvæ¨¡å—é€è¡Œå¤„ç†
    with open('large_file.csv', 'r', encoding='utf-8') as f:
        reader = csv.reader(f)
        for row in reader:
            process_row(row)  # é€è¡Œå¤„ç†
    ```

    è¿™äº›æ–¹æ³•è¦†ç›–äº†å¤§å¤šæ•°CSVæ–‡ä»¶å¤„ç†åœºæ™¯ï¼Œpandasé€šå¸¸æ˜¯æœ€æ–¹ä¾¿çš„é€‰æ‹©ã€‚

* python å¦‚ä½•åŠ è½½/ä¿å­˜ matlab save() ä¿å­˜çš„ binary æ–‡ä»¶ï¼Ÿ

    Python åŠ è½½/ä¿å­˜ MATLAB çš„ .mat æ–‡ä»¶ä¸»è¦é€šè¿‡ scipy.io <https://scipy.io/> æ¨¡å—å®ç°ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†æ–¹æ³•ï¼š

    1. åŸºç¡€æ–¹æ³•ï¼šä½¿ç”¨ scipy.io

        å®‰è£…ä¾èµ–

        ```bash
        pip install scipy numpy
        ```

        åŠ è½½MATLABæ–‡ä»¶

        ```python
        import scipy.io as sio
        import numpy as np

        # åŠ è½½.matæ–‡ä»¶
        mat_data = sio.loadmat('data.mat')

        # mat_dataæ˜¯ä¸€ä¸ªå­—å…¸ï¼ŒMATLABå˜é‡åä¸ºé”®
        print(mat_data.keys())  # æŸ¥çœ‹æ‰€æœ‰å˜é‡å

        # è®¿é—®å…·ä½“å˜é‡
        matrix_data = mat_data['variable_name']  # æ›¿æ¢ä¸ºå®é™…å˜é‡å
        array_data = mat_data['array_name']

        # æŸ¥çœ‹å˜é‡ä¿¡æ¯
        print(f"æ•°æ®ç±»å‹: {type(matrix_data)}")
        print(f"æ•°æ®å½¢çŠ¶: {matrix_data.shape}")
        print(f"æ•°æ®ç±»å‹: {matrix_data.dtype}")
        ```

        ä¿å­˜åˆ°MATLABæ–‡ä»¶

        ```python
        import scipy.io as sio
        import numpy as np

        # åˆ›å»ºæ•°æ®
        matrix1 = np.array([[1, 2, 3], [4, 5, 6]], dtype=np.float64)
        matrix2 = np.array([[7, 8, 9], [10, 11, 12]], dtype=np.float64)
        string_var = "Hello MATLAB"
        scalar_var = 42.5

        # ä¿å­˜ä¸º.matæ–‡ä»¶
        sio.savemat('output.mat', {
            'matrix1': matrix1,
            'matrix2': matrix2,
            'my_string': string_var,
            'scalar_value': scalar_var
        })
        ```

    2. é«˜çº§åŠŸèƒ½å’Œæ³¨æ„äº‹é¡¹

        å¤„ç†ä¸åŒMATLABç‰ˆæœ¬

        ```python
        # MATLAB v7.3æ ¼å¼ï¼ˆHDF5æ ¼å¼ï¼‰éœ€è¦h5py
        import h5py

        # åŠ è½½v7.3æ ¼å¼
        with h5py.File('data_v73.mat', 'r') as f:
            data = f['variable_name'][:]  # æ³¨æ„ç´¢å¼•æ–¹å¼ä¸åŒ

        # ä¿å­˜æ—¶æŒ‡å®šç‰ˆæœ¬
        sio.savemat('output_v7.mat', {'data': my_data}, do_compression=True)  # v7
        sio.savemat('output_v73.mat', {'data': my_data}, do_compression=True, 
                    format='7.3')  # v7.3
        ```

        å¤„ç†å¤æ‚æ•°æ®ç±»å‹

        ```python
        # ç»“æ„ä½“ï¼ˆstructï¼‰å¤„ç†
        mat_data = sio.loadmat('struct_data.mat', squeeze_me=True)
        struct_data = mat_data['my_struct']

        # å…ƒèƒæ•°ç»„ï¼ˆcell arrayï¼‰
        cell_array = mat_data['my_cell']

        # å¯¹äºåµŒå¥—ç»“æ„ä½“ï¼Œå¯èƒ½éœ€è¦é€’å½’å¤„ç†
        def unpack_mat_struct(struct_data):
            if isinstance(struct_data, np.ndarray) and struct_data.dtype.names:
                # è¿™æ˜¯ä¸€ä¸ªç»“æ„ä½“æ•°ç»„
                result = {}
                for name in struct_data.dtype.names:
                    result[name] = unpack_mat_struct(struct_data[name])
                return result
            return struct_data
        ```

        è¯»å–é€‰é¡¹å‚æ•°

        ```python
        # å¸¸ç”¨å‚æ•°
        mat_data = sio.loadmat('data.mat', 
                               mat_dtype=False,      # ä¸å¼ºåˆ¶è½¬æ¢ä¸ºmatlab double
                               squeeze_me=True,      # å‹ç¼©å•å…ƒç´ ç»´åº¦
                               struct_as_record=True, # ç»“æ„ä½“ä½œä¸ºè®°å½•æ•°ç»„
                               verify_compressed_data_nonempty=False,
                               variable_names=None)   # æŒ‡å®šè¯»å–çš„å˜é‡å
        ```

    3. å®ç”¨å·¥å…·å‡½æ•°

        æ‰¹é‡è½¬æ¢è„šæœ¬

        ```python
        import os
        import scipy.io as sio
        import numpy as np

        def convert_mat_to_npy(mat_dir, output_dir):
            """å°†ç›®å½•ä¸‹æ‰€æœ‰.matæ–‡ä»¶è½¬æ¢ä¸º.npyæ ¼å¼"""
            os.makedirs(output_dir, exist_ok=True)
            
            for filename in os.listdir(mat_dir):
                if filename.endswith('.mat'):
                    mat_path = os.path.join(mat_dir, filename)
                    data = sio.loadmat(mat_path)
                    
                    # ä¸ºæ¯ä¸ªå˜é‡å•ç‹¬ä¿å­˜
                    for key, value in data.items():
                        if not key.startswith('__'):  # è·³è¿‡å†…éƒ¨å˜é‡
                            npy_filename = f"{filename[:-4]}_{key}.npy"
                            npy_path = os.path.join(output_dir, npy_filename)
                            np.save(npy_path, value)
                            print(f"Saved {npy_filename}")

        def save_to_mat_with_metadata(data_dict, filename, metadata=None):
            """ä¿å­˜æ•°æ®å¹¶æ·»åŠ å…ƒæ•°æ®"""
            if metadata:
                # å°†å…ƒæ•°æ®ä½œä¸ºå˜é‡ä¿å­˜
                data_dict['_metadata'] = metadata
            
            sio.savemat(filename, data_dict, 
                        do_compression=True,
                        long_field_names=True)
        ```

    4. å¸¸è§é—®é¢˜è§£å†³

        å†…å­˜ä¼˜åŒ–

        ```python
        # éƒ¨åˆ†è¯»å–å¤§æ–‡ä»¶
        import h5py

        def read_large_mat_partial(filename, variable_name, start_idx, end_idx):
            """åˆ†å—è¯»å–å¤§MATæ–‡ä»¶"""
            with h5py.File(filename, 'r') as f:
                dataset = f[variable_name]
                return dataset[start_idx:end_idx]
        ```

        æ•°æ®ç±»å‹è½¬æ¢

        ```python
        def convert_matlab_types(mat_data):
            """è½¬æ¢MATLABæ•°æ®ç±»å‹åˆ°Pythonå‹å¥½æ ¼å¼"""
            converted = {}
            
            for key, value in mat_data.items():
                if not key.startswith('__'):
                    # å¤„ç†å¤æ•°
                    if np.iscomplexobj(value):
                        value = value.astype(np.complex128)
                    # å¤„ç†é€»è¾‘ç±»å‹
                    elif value.dtype == np.bool_ or value.dtype == bool:
                        value = value.astype(bool)
                    # å¤„ç†å­—ç¬¦ä¸²/cellä¸­çš„å­—ç¬¦ä¸²
                    elif isinstance(value, np.ndarray) and value.dtype.char == 'U':
                        value = str(value.item())
                    
                    converted[key] = value
            
            return converted
        ```

        å¤„ç†ç‰¹æ®Šå­—ç¬¦å’Œç¼–ç 

        ```python
        # å¤„ç†ä¸­æ–‡å­—ç¬¦
        def load_mat_with_encoding(filename, encoding='utf-8'):
            """å¤„ç†åŒ…å«éASCIIå­—ç¬¦çš„MATæ–‡ä»¶"""
            # scipy.io.loadmaté€šå¸¸èƒ½æ­£ç¡®å¤„ç†ç¼–ç 
            data = sio.loadmat(filename)
            
            # æ‰‹åŠ¨å¤„ç†å­—ç¬¦ä¸²å­—æ®µ
            for key in data:
                if isinstance(data[key], str):
                    try:
                        data[key] = data[key].encode('latin1').decode(encoding)
                    except:
                        pass
            
            return data
        ```

    5. å®Œæ•´ç¤ºä¾‹

        ```python
        import scipy.io as sio
        import numpy as np
        import matplotlib.pyplot as plt

        # ç¤ºä¾‹ï¼šåŠ è½½ã€å¤„ç†ã€ä¿å­˜MATLABæ•°æ®
        def process_matlab_data(input_file, output_file):
            # 1. åŠ è½½æ•°æ®
            mat_data = sio.loadmat(input_file)
            
            # 2. æå–å˜é‡
            signals = mat_data.get('signals', None)
            time_vector = mat_data.get('time', None)
            sampling_rate = mat_data.get('fs', 1000)  # é»˜è®¤é‡‡æ ·ç‡
            
            # 3. æ•°æ®å¤„ç†
            if signals is not None:
                # è®¡ç®—å‡å€¼
                mean_signal = np.mean(signals, axis=0)
                
                # æ»¤æ³¢ç­‰å¤„ç†
                # ...
                
                # 4. ä¿å­˜ç»“æœ
                sio.savemat(output_file, {
                    'original_signals': signals,
                    'processed_signals': mean_signal,
                    'time': time_vector,
                    'fs': sampling_rate,
                    'processing_info': f"Processed with Python on {np.datetime64('now')}"
                })
                
                print(f"Data saved to {output_file}")
                return True
            
            return False

        # ä½¿ç”¨ç¤ºä¾‹
        process_matlab_data('input_data.mat', 'processed_data.mat')
        ```

    é‡è¦æç¤º

    * ç‰ˆæœ¬å…¼å®¹æ€§ï¼šMATLAB v7.3åŠä»¥ä¸Šä½¿ç”¨HDF5æ ¼å¼ï¼Œéœ€è¦h5pyåº“

    * æ•°æ®ç±»å‹ï¼šæ³¨æ„MATLABå’ŒPythonæ•°æ®ç±»å‹çš„å·®å¼‚

    * å†…å­˜ç®¡ç†ï¼šå¤§æ–‡ä»¶ä½¿ç”¨format='7.3'å’ŒHDF5æ ¼å¼æ›´é«˜æ•ˆ

    * Unicodeï¼šMATLABå­—ç¬¦ä¸²å¯èƒ½ä½¿ç”¨ä¸åŒç¼–ç ï¼Œå¯èƒ½éœ€è¦è½¬æ¢

    * ç¨€ç–çŸ©é˜µï¼šä½¿ç”¨scipy.sparseå¤„ç†ç¨€ç–çŸ©é˜µ

    è¿™äº›æ–¹æ³•åŸºæœ¬è¦†ç›–äº†Pythonä¸MATLABæ•°æ®äº¤æ¢çš„æ‰€æœ‰å¸¸è§éœ€æ±‚ã€‚

* torch çš„ cpu backend ä¼šè‡ªåŠ¨å¤šçº¿ç¨‹å—ï¼Œè¿˜æ˜¯ä½¿ç”¨ cpu çš„ simd ç›¸å…³æŒ‡ä»¤é›†ï¼Ÿ

    PyTorch çš„ CPU backend ä¼šåŒæ—¶ä½¿ç”¨å¤šçº¿ç¨‹å’Œ SIMD æŒ‡ä»¤é›†ï¼Œä½†ä¸¤è€…çš„è§¦å‘æœºåˆ¶å’Œé…ç½®æ–¹å¼ä¸åŒã€‚

    1. è‡ªåŠ¨å¤šçº¿ç¨‹

        æ˜¯çš„ï¼ŒPyTorch CPU è¿ç®—é»˜è®¤ä¼šè‡ªåŠ¨ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œå…·ä½“è¡¨ç°ï¼š

        é…ç½®æ–¹å¼ï¼š

        ```python
        import torch

        # æŸ¥çœ‹å’Œè®¾ç½®çº¿ç¨‹æ•°
        print(torch.get_num_threads())    # è·å–å½“å‰çº¿ç¨‹æ•°
        print(torch.get_num_interop_threads())  # è·å–å¹¶è¡Œæ“ä½œçº¿ç¨‹æ•°

        # è®¾ç½®çº¿ç¨‹æ•°
        torch.set_num_threads(4)         # è®¾ç½®è®¡ç®—çº¿ç¨‹æ•°
        torch.set_num_interop_threads(2) # è®¾ç½®å¹¶è¡Œæ“ä½œçº¿ç¨‹æ•°
        ```

        ç¯å¢ƒå˜é‡æ§åˆ¶ï¼š

        ```bash
        # å¸¸ç”¨çš„ç¯å¢ƒå˜é‡
        export OMP_NUM_THREADS=4        # OpenMP çº¿ç¨‹æ•°ï¼ˆå½±å“åº•å±‚è¿ç®—ï¼‰
        export MKL_NUM_THREADS=4        # MKL çº¿ç¨‹æ•°ï¼ˆå¦‚æœæœ‰ç”¨ MKLï¼‰
        ```

    2. SIMD æŒ‡ä»¤é›†ä¼˜åŒ–

        PyTorch ä¼šè‡ªåŠ¨åˆ©ç”¨ CPU çš„ SIMD æŒ‡ä»¤é›†ï¼š

        æ”¯æŒçš„æŒ‡ä»¤é›†ï¼š

        * SSE4.2

        * AVX2

        * AVX-512ï¼ˆå¦‚æœ CPU æ”¯æŒï¼‰

        * ARM NEONï¼ˆARM æ¶æ„ï¼‰

        æ£€æŸ¥æ˜¯å¦å¯ç”¨ï¼š

        ```python
        import torch

        # æ£€æŸ¥æ„å»ºæ—¶å¯ç”¨çš„æŒ‡ä»¤é›†ï¼ˆéœ€è¦ä»æºç ç¼–è¯‘çš„ä¿¡æ¯ï¼‰
        print(torch.__config__.show())  # æ˜¾ç¤ºæ„å»ºé…ç½®

        # è¿è¡Œæ—¶æ£€æµ‹
        print("æ˜¯å¦ä½¿ç”¨MKL:", torch.backends.mkl.is_available())
        print("æ˜¯å¦ä½¿ç”¨OpenMP:", torch.backends.openmp.is_available())
        ```

        è‡ªåŠ¨ä¼˜åŒ–æœºåˆ¶ï¼š

        * PyTorch åœ¨ç¼–è¯‘æ—¶ä¼šæ ¹æ® CPU æ¶æ„ç”Ÿæˆå¤šç‰ˆæœ¬ä»£ç 

        * è¿è¡Œæ—¶é€šè¿‡ CPU ç‰¹æ€§æ£€æµ‹é€‰æ‹©æœ€ä¼˜çš„ä»£ç è·¯å¾„

        * åº•å±‚ä½¿ç”¨ Eigenã€MKLã€OpenBLAS ç­‰ä¼˜åŒ–çš„æ•°å­¦åº“

    3. å®é™…ç¤ºä¾‹

        ```python
        import torch
        import time

        # åˆ›å»ºä¸€ä¸ªè¾ƒå¤§çš„å¼ é‡
        x = torch.randn(10000, 10000)
        y = torch.randn(10000, 10000)

        # æŸ¥çœ‹é»˜è®¤çº¿ç¨‹æ•°
        print(f"çº¿ç¨‹æ•°: {torch.get_num_threads()}")

        # çŸ©é˜µä¹˜æ³•ï¼ˆä¼šè‡ªåŠ¨å¹¶è¡ŒåŒ–å’ŒSIMDä¼˜åŒ–ï¼‰
        start = time.time()
        z = torch.matmul(x, y)
        end = time.time()

        print(f"è®¡ç®—æ—¶é—´: {end - start:.3f}ç§’")
        print(f"å¼ é‡å½¢çŠ¶: {z.shape}")
        ```

    4. æ€§èƒ½è°ƒä¼˜å»ºè®®

        æ¨èé…ç½®ï¼š

        ```python
        # åœ¨ç¨‹åºå¼€å§‹æ—¶è®¾ç½®
        import torch
        import os

        # é€šå¸¸è®¾ç½®ä¸ºç‰©ç†æ ¸å¿ƒæ•°
        num_cores = os.cpu_count()
        torch.set_num_threads(num_cores)

        # æˆ–è€…è®© OpenMP è‡ªåŠ¨ç®¡ç†
        os.environ['OMP_NUM_THREADS'] = str(num_cores)
        os.environ['MKL_NUM_THREADS'] = str(num_cores)
        ```

        æ³¨æ„äº‹é¡¹ï¼š

        * çº¿ç¨‹æ•°ä¸è¦è¶…è¿‡ç‰©ç†æ ¸å¿ƒæ•°ï¼Œå¦åˆ™å¯èƒ½å› ä¸Šä¸‹æ–‡åˆ‡æ¢é™ä½æ€§èƒ½

        * SIMD ä¼˜åŒ–æ˜¯è‡ªåŠ¨çš„ï¼Œä½†éœ€è¦ PyTorch ç¼–è¯‘æ—¶æ”¯æŒå¯¹åº”çš„æŒ‡ä»¤é›†

        * å°çŸ©é˜µè¿ç®—å¯èƒ½ä¸ä¼šå……åˆ†å¹¶è¡ŒåŒ–ï¼ˆå¼€é”€å¤§äºæ”¶ç›Šï¼‰

        * I/O å¯†é›†å‹ä»»åŠ¡ä¸è®¡ç®—å¯†é›†å‹ä»»åŠ¡çš„çº¿ç¨‹é…ç½®å¯èƒ½ä¸åŒ

    5. éªŒè¯ä¼˜åŒ–æ•ˆæœ

        ```python
        import torch
        import numpy as np

        # æ¯”è¾ƒæœ‰æ— å¤šçº¿ç¨‹çš„æ€§èƒ½å·®å¼‚
        torch.set_num_threads(1)  # å•çº¿ç¨‹
        x = torch.randn(5000, 5000)
        start = time.time()
        _ = x @ x
        print(f"å•çº¿ç¨‹æ—¶é—´: {time.time() - start:.3f}s")

        torch.set_num_threads(8)  # å¤šçº¿ç¨‹
        start = time.time()
        _ = x @ x
        print(f"8çº¿ç¨‹æ—¶é—´: {time.time() - start:.3f}s")
        ```

    æ€»ç»“ï¼š

    * âœ… å¤šçº¿ç¨‹æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå¯é€šè¿‡ torch.set_num_threads() é…ç½®

    * âœ… SIMD ä¼˜åŒ–æ˜¯è‡ªåŠ¨çš„ï¼ŒPyTorch ä¼šæ£€æµ‹å¹¶é€‰æ‹©æœ€ä¼˜æŒ‡ä»¤é›†

    * âš ï¸ æœ€ä½³çº¿ç¨‹æ•°å–å†³äºå…·ä½“ä»»åŠ¡å’Œç¡¬ä»¶

    * ğŸ“Š å¤§çŸ©é˜µè¿ç®—æœ€èƒ½ä½“ç°å¹¶è¡ŒåŒ–å’Œ SIMD çš„ä¼˜åŠ¿

    PyTorch åœ¨ CPU ä¸Šçš„æ€§èƒ½å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºåº•å±‚çš„æ•°å­¦åº“ï¼ˆMKLã€OpenBLAS ç­‰ï¼‰ï¼Œè¿™äº›åº“æœ¬èº«å°±åŒ…å«äº†é«˜åº¦ä¼˜åŒ–çš„å¤šçº¿ç¨‹å’Œ SIMD å®ç°ã€‚

* torch set_num_threads() ä¸ set_num_interop_threads() åŒºåˆ«

    torch.set_num_threads() å’Œ torch.set_num_interop_threads() æ§åˆ¶çš„æ˜¯ ä¸åŒå±‚é¢çš„å¹¶è¡ŒåŒ–ï¼Œç†è§£å®ƒä»¬çš„åŒºåˆ«å¯¹äºæ€§èƒ½è°ƒä¼˜å¾ˆé‡è¦ã€‚

    ä¸»è¦åŒºåˆ«

    | ç‰¹æ€§ | torch.set_num_threads() | torch.set_num_interop_threads() |
    | - | - | - |
    | ä½œç”¨å¯¹è±¡ | å•ä¸ªæ“ä½œå†…éƒ¨å¹¶è¡Œï¼ˆå¦‚çŸ©é˜µä¹˜æ³•ï¼‰ | å¤šä¸ªç‹¬ç«‹æ“ä½œé—´çš„å¹¶è¡Œï¼ˆå¦‚å¤šä¸ªç‹¬ç«‹çš„çŸ©é˜µä¹˜æ³•ï¼‰ |
    | å¹¶è¡Œå±‚çº§ | æ“ä½œå†…å¹¶è¡Œï¼ˆintra-opï¼‰ | æ“ä½œé—´å¹¶è¡Œï¼ˆinter-opï¼‰ |
    | å…¸å‹åœºæ™¯ | å¤§å‹çŸ©é˜µè¿ç®—ã€å·ç§¯ç­‰ | æ•°æ®åŠ è½½ã€å¤šä¸ªå°æ“ä½œçš„å¹¶è¡Œæ‰§è¡Œ |
    | é»˜è®¤å€¼ | CPU æ ¸å¿ƒæ•° | é€šå¸¸ä¸º 1ï¼ˆä¿å®ˆé»˜è®¤ï¼‰ |
    | çº¿ç¨‹æ±  | ä¸åŒçš„çº¿ç¨‹æ±  | ä¸åŒçš„çº¿ç¨‹æ±  |

    è¯¦ç»†è§£é‡Š

    1. torch.set_num_threads() - æ“ä½œå†…å¹¶è¡Œ

        ```python
        import torch
        import time

        # è®¾ç½®æ“ä½œå†…å¹¶è¡Œçº¿ç¨‹æ•°
        torch.set_num_threads(4)  # è¿™ä¸ªæ“ä½œå†…éƒ¨æœ€å¤šç”¨4ä¸ªçº¿ç¨‹

        # å•ä¸€å¤§æ“ä½œä¼šè¢«æ‹†åˆ†æˆå¤šä¸ªå­ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œ
        x = torch.randn(5000, 5000)
        y = torch.randn(5000, 5000)

        # è¿™ä¸ªçŸ©é˜µä¹˜æ³•ä¼šåœ¨å†…éƒ¨ä½¿ç”¨æœ€å¤š4ä¸ªçº¿ç¨‹
        z = x @ y  # æ“ä½œå†…å¹¶è¡Œ
        ```

        å·¥ä½œæ–¹å¼ï¼š

        * å•ä¸ªå¤æ‚æ“ä½œï¼ˆå¦‚å¤§çŸ©é˜µä¹˜æ³•ï¼‰è¢«åˆ†è§£æˆå¤šä¸ªå­ä»»åŠ¡

        * è¿™äº›å­ä»»åŠ¡åœ¨å¤šä¸ªçº¿ç¨‹ä¸Šå¹¶è¡Œæ‰§è¡Œ

        * æ‰€æœ‰çº¿ç¨‹å…±åŒå®Œæˆè¿™ä¸€ä¸ªæ“ä½œ

    2. torch.set_num_interop_threads() - æ“ä½œé—´å¹¶è¡Œ

        ```python
        import torch
        import concurrent.futures

        # è®¾ç½®æ“ä½œé—´å¹¶è¡Œçº¿ç¨‹æ•°
        torch.set_num_interop_threads(2)  # æœ€å¤šåŒæ—¶æ‰§è¡Œ2ä¸ªç‹¬ç«‹æ“ä½œ
        torch.set_num_threads(2)  # æ¯ä¸ªæ“ä½œå†…éƒ¨æœ€å¤šç”¨2ä¸ªçº¿ç¨‹

        def compute(i):
            x = torch.randn(1000, 1000)
            y = torch.randn(1000, 1000)
            return (x @ y).mean()

        # å¤šä¸ªç‹¬ç«‹çš„çŸ©é˜µä¹˜æ³•å¯ä»¥å¹¶è¡Œæ‰§è¡Œ
        # ç”±äºè®¾ç½®äº† interop_threads=2ï¼Œæœ€å¤š2ä¸ªæ“ä½œåŒæ—¶è¿›è¡Œ
        results = []
        for i in range(4):
            results.append(compute(i))
        ```

    å®é™…åº”ç”¨åœºæ™¯å¯¹æ¯”

    åœºæ™¯1ï¼šå•ä¸ªå¤§ä»»åŠ¡

    ```python
    # é€‚åˆç”¨ set_num_threads() ä¼˜åŒ–
    torch.set_num_threads(8)  # è®©å•ä¸ªå¤§æ“ä½œç”¨8ä¸ªæ ¸å¿ƒ
    torch.set_num_interop_threads(1)  # åªæœ‰ä¸€ä¸ªæ“ä½œï¼Œæ— éœ€æ“ä½œé—´å¹¶è¡Œ

    # å•ä¸ªå¤§å‹çŸ©é˜µè¿ç®—
    large_matrix = torch.randn(10000, 10000)
    result = large_matrix @ large_matrix.T  # è¿™ä¸ªæ“ä½œå†…éƒ¨ä¼šå¹¶è¡Œ
    ```

    åœºæ™¯2ï¼šå¤šä¸ªå°ä»»åŠ¡

    ```python
    # é€‚åˆç”¨ set_num_interop_threads() ä¼˜åŒ–
    torch.set_num_threads(2)  # æ¯ä¸ªå°æ“ä½œç”¨2ä¸ªæ ¸å¿ƒ
    torch.set_num_interop_threads(4)  # åŒæ—¶æ‰§è¡Œ4ä¸ªå°æ“ä½œ

    # å¤šä¸ªç‹¬ç«‹çš„å°è¿ç®—
    def process_batch(batch_data):
        return torch.mm(batch_data, batch_data.T)

    # å¦‚æœæœ‰4ä¸ªbatchï¼Œå¯ä»¥å¹¶è¡Œå¤„ç†
    batches = [torch.randn(500, 500) for _ in range(4)]
    results = [process_batch(batch) for batch in batches]
    ```

    åœºæ™¯3ï¼šæ··åˆåœºæ™¯

    ```python
    # æ•°æ®åŠ è½½ï¼ˆæ“ä½œé—´å¹¶è¡Œï¼‰ + è®¡ç®—ï¼ˆæ“ä½œå†…å¹¶è¡Œï¼‰
    torch.set_num_interop_threads(2)  # åŒæ—¶åŠ è½½2ä¸ªbatch
    torch.set_num_threads(4)          # æ¯ä¸ªbatchè®¡ç®—ç”¨4ä¸ªæ ¸å¿ƒ

    # å‡è®¾çš„æ•°æ®åŠ è½½å’Œè®¡ç®—æµç¨‹
    def load_and_compute(i):
        # æ¨¡æ‹Ÿæ•°æ®åŠ è½½
        data = torch.randn(1000, 1000)
        # è®¡ç®—
        return data @ data.T

    # å¯ä»¥åŒæ—¶åŠ è½½å’Œè®¡ç®—å¤šä¸ªbatch
    ```

    æ€§èƒ½å½±å“ç¤ºä¾‹

    ```python
    import torch
    import time

    # æµ‹è¯•ä¸åŒé…ç½®çš„æ€§èƒ½
    def benchmark():
        # åˆ›å»ºå¤šä¸ªå°çŸ©é˜µ
        matrices = [torch.randn(500, 500) for _ in range(8)]
        
        # é…ç½®1ï¼šåªæœ‰æ“ä½œå†…å¹¶è¡Œ
        torch.set_num_threads(4)
        torch.set_num_interop_threads(1)
        
        start = time.time()
        results = [m @ m.T for m in matrices]
        print(f"åªæœ‰æ“ä½œå†…å¹¶è¡Œ: {time.time()-start:.3f}s")
        
        # é…ç½®2ï¼šåªæœ‰æ“ä½œé—´å¹¶è¡Œ
        torch.set_num_threads(1)
        torch.set_num_interop_threads(4)
        
        start = time.time()
        results = [m @ m.T for m in matrices]
        print(f"åªæœ‰æ“ä½œé—´å¹¶è¡Œ: {time.time()-start:.3f}s")
        
        # é…ç½®3ï¼šä¸¤è€…ç»“åˆ
        torch.set_num_threads(2)
        torch.set_num_interop_threads(2)
        
        start = time.time()
        results = [m @ m.T for m in matrices]
        print(f"ä¸¤è€…ç»“åˆ(2x2): {time.time()-start:.3f}s")

    benchmark()
    ```

    æœ€ä½³å®è·µå»ºè®®

    * ç¡®å®šå·¥ä½œè´Ÿè½½ç±»å‹ï¼š

        * è®¡ç®—å¯†é›†å‹å¤§æ“ä½œ â†’ å¢åŠ  num_threads

        * å¤šä¸ªç‹¬ç«‹å°æ“ä½œ â†’ å¢åŠ  num_interop_threads

    * é€šç”¨æ¨èé…ç½®ï¼š

        ```python
        import os

        total_cores = os.cpu_count()

        # é€šç”¨åœºæ™¯ï¼šå¹³è¡¡é…ç½®
        torch.set_num_threads(total_cores // 2)
        torch.set_num_interop_threads(2)

        # æ•°æ®é¢„å¤„ç†æµæ°´çº¿
        # torch.set_num_threads(2)  # æ¯ä¸ªé¢„å¤„ç†ä»»åŠ¡ç”¨2æ ¸å¿ƒ
        # torch.set_num_interop_threads(4)  # åŒæ—¶é¢„å¤„ç†4ä¸ªbatch
        ```

    * æ³¨æ„èµ„æºç«äº‰ï¼š

        ```python
        # ä¸è¦è®¾ç½®è¿‡å¤§ï¼Œé¿å…çº¿ç¨‹ç«äº‰
        # æ€»çº¿ç¨‹æ•° â‰ˆ num_threads * num_interop_threads
        # å»ºè®®ä¸è¶…è¿‡ç‰©ç†æ ¸å¿ƒæ•°

        # é”™è¯¯ç¤ºä¾‹ï¼ˆå¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™ï¼‰ï¼š
        # torch.set_num_threads(8)
        # torch.set_num_interop_threads(8)  # æœ€å¤š64ä¸ªçº¿ç¨‹ï¼
        ```

    ä¸ DataLoader çš„å…³ç³»

    ```python
    from torch.utils.data import DataLoader

    # DataLoader æœ‰è‡ªå·±çš„å¹¶è¡Œæœºåˆ¶ï¼ˆnum_workersï¼‰
    # ä¸ torch çš„çº¿ç¨‹è®¾ç½®æ˜¯ç‹¬ç«‹çš„

    # å…¸å‹é…ç½®ï¼š
    loader = DataLoader(dataset, 
                       batch_size=32,
                       num_workers=4,      # æ•°æ®åŠ è½½è¿›ç¨‹æ•°
                       pin_memory=True)

    # PyTorch è®¡ç®—çº¿ç¨‹è®¾ç½®
    torch.set_num_threads(4)          # æ¯ä¸ªGPUæ“ä½œç”¨4çº¿ç¨‹
    torch.set_num_interop_threads(1)  # é€šå¸¸GPUæ“ä½œæ˜¯ä¸²è¡Œçš„
    ```

    æ€»ç»“ï¼š

    * torch.set_num_threads()ï¼šå‚ç›´æ‰©å±•ï¼Œè®©å•ä¸ªä»»åŠ¡æ›´å¿«

    * torch.set_num_interop_threads()ï¼šæ°´å¹³æ‰©å±•ï¼Œè®©å¤šä¸ªä»»åŠ¡åŒæ—¶è¿›è¡Œ

    * æ ¹æ®å…·ä½“åœºæ™¯è°ƒæ•´ï¼Œä¸¤è€…ä¹˜ç§¯ä¸è¦è¶…è¿‡CPUç‰©ç†æ ¸å¿ƒæ•°

    * å¯¹äºå¤§å¤šæ•°æ·±åº¦å­¦ä¹ è®­ç»ƒï¼Œè°ƒæ•´ num_threads æ›´é‡è¦

* é™¤äº† echartsï¼Œå‰ç«¯è¿˜æœ‰å“ªäº›ç±»ä¼¼ matplotlib çš„å¯è§†åŒ–åº“

    é™¤äº† EChartsï¼Œå‰ç«¯è¿˜æœ‰ä¸å°‘ä¼˜ç§€çš„å¯è§†åŒ–åº“ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›ç±»ä¼¼ Matplotlib é£æ ¼ï¼ˆæ³¨é‡æ•°æ®é©±åŠ¨ã€å›¾è¡¨ç±»å‹ä¸°å¯Œï¼‰çš„åº“ï¼š

    1. åŸºäº SVG/Canvas çš„é€šç”¨åº“

        D3.js

        * ç‰¹ç‚¹ï¼šåº•å±‚æ•°æ®é©±åŠ¨åº“ï¼Œé«˜åº¦çµæ´»ï¼Œå¯å®šåˆ¶ä»»ä½•å¯è§†åŒ–æ•ˆæœã€‚

        * é€‚ç”¨åœºæ™¯ï¼šå¤æ‚å®šåˆ¶åŒ–å›¾è¡¨ã€æ•°æ®å¯è§†åŒ–ç ”ç©¶ã€‚

        * ç¤ºä¾‹ï¼šåŠ›å¯¼å‘å›¾ã€åœ°å›¾å®šåˆ¶ã€åŠ¨æ€äº¤äº’ã€‚

        * å®˜ç½‘ï¼šd3js.org

            <https://d3js.org/>

        Chart.js

        * ç‰¹ç‚¹ï¼šè½»é‡çº§ï¼ˆçº¦ 60KBï¼‰ã€ç®€å•æ˜“ç”¨ï¼Œæ”¯æŒ Canvas æ¸²æŸ“ã€‚

        * é€‚ç”¨åœºæ™¯ï¼šç§»åŠ¨ç«¯å‹å¥½ã€åŸºç¡€å›¾è¡¨ï¼ˆæŠ˜çº¿ã€æŸ±çŠ¶ã€é¥¼å›¾ç­‰ï¼‰ã€‚

        * å®˜ç½‘ï¼šchartjs.org

            <https://www.chartjs.org/>

        Highcharts

        * ç‰¹ç‚¹ï¼šå•†ä¸šçº§å›¾è¡¨åº“ï¼Œå…¼å®¹æ€§å¥½ï¼Œæ”¯æŒå¯¼å‡ºåŠŸèƒ½ã€‚

        * é€‚ç”¨åœºæ™¯ï¼šä¼ä¸šæŠ¥è¡¨ã€å•†ä¸šæ•°æ®åˆ†æã€‚

        * è®¸å¯è¯ï¼šå…è´¹ç”¨äºéå•†ä¸šé¡¹ç›®ï¼Œå•†ä¸šéœ€ä»˜è´¹ã€‚

        * å®˜ç½‘ï¼šhighcharts.com

            <https://www.highcharts.com/>

        Plotly.js

        * ç‰¹ç‚¹ï¼šåŸºäº D3.js å’Œ WebGLï¼Œæ”¯æŒ 3D å›¾è¡¨ã€ç§‘å­¦å›¾è¡¨ã€‚

        * é€‚ç”¨åœºæ™¯ï¼šäº¤äº’å¼ç§‘å­¦å›¾è¡¨ã€é‡‘èæ•°æ®å¯è§†åŒ–ã€‚

        * å®˜ç½‘ï¼šplotly.com/javascript

            <https://plot.ly/javascript/>

    2. å£°æ˜å¼è¯­æ³•åº“

        Vega / Vega-Lite

        * ç‰¹ç‚¹ï¼šJSON è¯­æ³•å£°æ˜å›¾è¡¨ï¼Œæ— éœ€ç¼–ç¨‹å³å¯ç”Ÿæˆå¯è§†åŒ–ã€‚

        * é€‚ç”¨åœºæ™¯ï¼šé…ç½®åŒ–å›¾è¡¨ç”Ÿæˆã€å­¦æœ¯å¯è§†åŒ–ã€‚

        * å®˜ç½‘ï¼švega.github.io

            <https://vega.github.io/>

    3. é¢å‘æ¡†æ¶çš„åº“

        Rechartsï¼ˆReactï¼‰

        * ç‰¹ç‚¹ï¼šåŸºäº React å’Œ D3ï¼Œç»„ä»¶åŒ–å£°æ˜å¼è¯­æ³•ã€‚

        * é€‚ç”¨åœºæ™¯ï¼šReact é¡¹ç›®ä¸­çš„ç®€å•å›¾è¡¨é›†æˆã€‚

        * å®˜ç½‘ï¼šrecharts.org

            <https://recharts.org/>

        Victoryï¼ˆReact/React Nativeï¼‰

        * ç‰¹ç‚¹ï¼šReact ç”Ÿæ€ä¸­çš„æ¨¡å—åŒ–å›¾è¡¨åº“ï¼Œæ”¯æŒç§»åŠ¨ç«¯ã€‚

        * é€‚ç”¨åœºæ™¯ï¼šReact Native æˆ– React é¡¹ç›®ã€‚

        * å®˜ç½‘ï¼šformidable.com/open-source/victory

            <https://formidable.com/open-source/victory/>

        ApexCharts

        * ç‰¹ç‚¹ï¼šç°ä»£äº¤äº’å¼å›¾è¡¨ï¼Œæ”¯æŒ Vue/React/React Nativeã€‚

        * é€‚ç”¨åœºæ™¯ï¼šå“åº”å¼ä»ªè¡¨ç›˜ã€å®æ—¶æ•°æ®æ›´æ–°ã€‚

        * å®˜ç½‘ï¼šapexcharts.com

            <https://apexcharts.com/>

    4. ä¸“ä¸šé¢†åŸŸåº“

        Three.js / Babylon.js

        * ç‰¹ç‚¹ï¼šWebGL 3D æ¸²æŸ“åº“ï¼Œé€‚åˆå¤æ‚ 3D å¯è§†åŒ–ã€‚

        * é€‚ç”¨åœºæ™¯ï¼š3D æ¨¡å‹ã€åœ°ç†å¯è§†åŒ–ã€æ¸¸æˆåŒ–æ•°æ®å±•ç¤ºã€‚

        * å®˜ç½‘ï¼šthreejs.org / babylonjs.com

            <https://threejs.org/>

            <https://www.babylonjs.com/>

        Mapbox GL JS / Leaflet

        * ç‰¹ç‚¹ï¼šä¸“ä¸šåœ°å›¾å¯è§†åŒ–åº“ã€‚

        * é€‚ç”¨åœºæ™¯ï¼šåœ°ç†æ•°æ®ã€è½¨è¿¹çƒ­åŠ›å›¾ç­‰ã€‚

        * å®˜ç½‘ï¼šmapbox.com / leafletjs.com

            <https://docs.mapbox.com/mapbox-gl-js/>

            <https://leafletjs.com/>

    5. è½»é‡çº§æˆ–æ–°å…´åº“

        AntV ç³»åˆ—ï¼ˆèš‚èšé›†å›¢ï¼‰

        * ç‰¹ç‚¹ï¼šåŒ…å« G2ï¼ˆé€šç”¨å›¾è¡¨ï¼‰ã€G6ï¼ˆå›¾å¯è§†åŒ–ï¼‰ã€L7ï¼ˆåœ°ç†å¯è§†åŒ–ï¼‰ã€‚

        * é€‚ç”¨åœºæ™¯ï¼šä¼ä¸šçº§å¤æ‚å¯è§†åŒ–éœ€æ±‚ã€‚

        * å®˜ç½‘ï¼šantv.vision

            <https://antv.vision/>

        Observable Plot

        * ç‰¹ç‚¹ï¼šD3 ä½œè€…æ¨å‡ºçš„è½»é‡çº§åº“ï¼Œè¯­æ³•ç®€æ´ã€‚

        * é€‚ç”¨åœºæ™¯ï¼šå¿«é€Ÿç”ŸæˆåŸºç¡€å›¾è¡¨ã€æ•°æ®æ¢ç´¢ã€‚

        * å®˜ç½‘ï¼šobservablehq.com/plot

            <https://observablehq.com/plot/>

        Chartist.js

        * ç‰¹ç‚¹ï¼šå“åº”å¼ã€CSS é©±åŠ¨åŠ¨ç”»çš„è½»é‡åº“ã€‚

        * é€‚ç”¨åœºæ™¯ï¼šç§»åŠ¨ç«¯ç®€å•å›¾è¡¨ã€‚

        * å®˜ç½‘ï¼šgionkunz.github.io/chartist-js

            <https://observablehq.com/plot/>

    é€‰æ‹©å»ºè®®

    * å¿«é€Ÿä¸Šæ‰‹ï¼šChart.jsã€Rechartsï¼ˆReactï¼‰ã€ApexChartsã€‚

    * é«˜åº¦å®šåˆ¶ï¼šD3.jsã€Three.jsã€‚

    * å•†ä¸šæŠ¥è¡¨ï¼šHighchartsã€EChartsã€‚

    * å­¦æœ¯/ç§‘å­¦å¯è§†åŒ–ï¼šPlotly.jsã€Vega-Liteã€‚

    * åœ°ç†æ•°æ®ï¼šMapbox GL JSã€Leafletã€‚

    è¿™äº›åº“å„æœ‰ä¾§é‡ï¼Œå¯æ ¹æ®é¡¹ç›®éœ€æ±‚ï¼ˆå¦‚æ€§èƒ½ã€å…¼å®¹æ€§ã€äº¤äº’å¤æ‚åº¦ï¼‰é€‰æ‹©ã€‚

* vim æ›¿æ¢å‘½ä»¤çš„ example: ä¸ºæ¯ä¸ªéç©ºè¡Œè¡Œé¦–æ·»åŠ æ˜Ÿå·

    `vnoremap <leader>l :s/^\s*\zs\S.*$/* &/<CR>`

    è¿™è¡Œ Vim å‘½ä»¤çš„ä½œç”¨æ˜¯ åœ¨å¯è§†æ¨¡å¼ä¸‹ï¼Œç»™é€‰ä¸­çš„æ¯ä¸€è¡Œæ·»åŠ  Markdown é£æ ¼çš„åˆ—è¡¨æ ‡è®°ã€‚

    å…·ä½“è§£æï¼š

    * `vnoremap`ï¼šåœ¨å¯è§†æ¨¡å¼ä¸‹åˆ›å»ºæ˜ å°„

    * `<leader>l`ï¼šå½“æŒ‰ä¸‹ <leader> é”®ï¼ˆé€šå¸¸æ˜¯ \ï¼‰å’Œ l é”®æ—¶è§¦å‘

    * :s/^\s*\zs\S.*$/* &/ï¼šæ›¿æ¢å‘½ä»¤

        * `^\s*`ï¼šåŒ¹é…è¡Œé¦–çš„ç©ºç™½å­—ç¬¦

        * `\zs`ï¼šè®¾ç½®åŒ¹é…å¼€å§‹ä½ç½®ï¼ˆä¸æ›¿æ¢å‰é¢çš„ç©ºç™½ï¼‰

        * `\S.*$`ï¼šåŒ¹é…ç¬¬ä¸€ä¸ªéç©ºç™½å­—ç¬¦åˆ°è¡Œå°¾çš„å†…å®¹

        * `* &`ï¼šæ›¿æ¢ä¸º * åŠ ä¸ŠåŸåŒ¹é…å†…å®¹ï¼ˆ& ä»£è¡¨åŒ¹é…çš„å†…å®¹ï¼‰

    * `<CR>`ï¼šå›è½¦æ‰§è¡Œå‘½ä»¤

* vim ä¸­å¤§å†™å­—æ¯å‘½ä»¤çš„ä½œç”¨

    åœ¨ Vim ä¸­ï¼Œå¤§å†™å­—æ¯å‘½ä»¤é€šå¸¸æ˜¯å…¶å¯¹åº”å°å†™å­—æ¯å‘½ä»¤çš„"å¢å¼ºç‰ˆ"æˆ–"ç›¸åæ–¹å‘ç‰ˆ"ã€‚ä»¥ä¸‹æ˜¯ä¸»è¦å¤§å†™å‘½ä»¤çš„æ¦‚è¿°ï¼š

    å…‰æ ‡ç§»åŠ¨ç±»

    * H - Highï¼šç§»åŠ¨åˆ°å±å¹•é¡¶éƒ¨ï¼ˆHome positionï¼‰

        * h å‘å·¦ç§»åŠ¨ï¼ŒH ç§»åŠ¨åˆ°å±å¹•æœ€ä¸Šæ–¹

    * M - Middleï¼šç§»åŠ¨åˆ°å±å¹•ä¸­é—´

    * L - Lowï¼šç§»åŠ¨åˆ°å±å¹•åº•éƒ¨

        * l å‘å³ç§»åŠ¨ï¼ŒL ç§»åŠ¨åˆ°å±å¹•æœ€ä¸‹æ–¹

    æ’å…¥æ¨¡å¼ç±»

    * I - Insert åœ¨è¡Œé¦–ï¼šåœ¨è¡Œé¦–ç¬¬ä¸€ä¸ªéç©ºç™½å­—ç¬¦å‰æ’å…¥

        * i åœ¨å½“å‰å…‰æ ‡å‰æ’å…¥ï¼ŒI åœ¨è¡Œé¦–æ’å…¥

    * A - Append åœ¨è¡Œå°¾ï¼šåœ¨è¡Œå°¾è¿½åŠ 

        * a åœ¨å½“å‰å…‰æ ‡åæ’å…¥ï¼ŒA åœ¨è¡Œå°¾æ’å…¥

    * O - åœ¨å½“å‰è¡Œä¸Šæ–¹æ–°å»ºä¸€è¡Œ

        * o åœ¨å½“å‰è¡Œä¸‹æ–¹æ–°å»ºä¸€è¡Œï¼ŒO åœ¨ä¸Šæ–¹æ–°å»º

    æ–‡æœ¬å¯¹è±¡æ“ä½œç±»

    * C - Change åˆ°è¡Œå°¾ï¼šåˆ é™¤ä»å…‰æ ‡åˆ°è¡Œå°¾å¹¶è¿›å…¥æ’å…¥æ¨¡å¼

        * c{motion} åˆ é™¤æŒ‡å®šèŒƒå›´å¹¶æ’å…¥ï¼ŒC = c$

    * D - Delete åˆ°è¡Œå°¾ï¼šåˆ é™¤ä»å…‰æ ‡åˆ°è¡Œå°¾

        * d{motion} åˆ é™¤æŒ‡å®šèŒƒå›´ï¼ŒD = d$

    * S - åˆ é™¤æ•´è¡Œå¹¶è¿›å…¥æ’å…¥æ¨¡å¼ï¼ˆSubstitute lineï¼‰

        * s åˆ é™¤å•ä¸ªå­—ç¬¦å¹¶æ’å…¥ï¼ŒS = ^C æˆ– ddO

    * Y - Yank æ•´è¡Œ

        * y{motion} å¤åˆ¶æŒ‡å®šèŒƒå›´ï¼ŒY = yyï¼ˆå¤åˆ¶æ•´è¡Œï¼‰

    è·³è½¬ä¸æœç´¢ç±»

    * F - å‘å‰ï¼ˆå³ï¼‰æœç´¢å­—ç¬¦å¹¶è·³è½¬åˆ°è¯¥å­—ç¬¦ä¸Š

        * f{char} è·³åˆ°å­—ç¬¦ï¼ŒF å‘å·¦æœç´¢

    * T - å‘å‰ï¼ˆå³ï¼‰æœç´¢å­—ç¬¦å¹¶è·³åˆ°è¯¥å­—ç¬¦å‰

        * t{char} è·³åˆ°å­—ç¬¦å‰ï¼ŒT å‘å·¦æœç´¢

    * G - Go åˆ°æœ€åä¸€è¡Œæˆ–æŒ‡å®šè¡Œ

        * gg åˆ°ç¬¬ä¸€è¡Œï¼ŒG åˆ°æœ€åä¸€è¡Œï¼Œ{n}G åˆ°ç¬¬ n è¡Œ

    å…¶ä»–å¸¸ç”¨

    * X - åˆ é™¤å…‰æ ‡å‰çš„å­—ç¬¦

        * x åˆ é™¤å…‰æ ‡ä¸‹çš„å­—ç¬¦ï¼ŒX åˆ é™¤å…‰æ ‡å‰çš„å­—ç¬¦

    * P - ç²˜è´´åˆ°å…‰æ ‡å‰

        * p ç²˜è´´åˆ°å…‰æ ‡åï¼ŒP ç²˜è´´åˆ°å…‰æ ‡å‰

    * J - è¿æ¥å½“å‰è¡Œå’Œä¸‹ä¸€è¡Œï¼ˆJoinï¼‰

        * j å‘ä¸‹ç§»åŠ¨ï¼ŒJ åˆå¹¶è¡Œ

    è®°å¿†æŠ€å·§

    * ä½ç½®ç›¸å…³ï¼šHï¼ˆé«˜ï¼‰ã€Mï¼ˆä¸­ï¼‰ã€Lï¼ˆä½ï¼‰

    * è¡Œç›¸å…³ï¼šIï¼ˆè¡Œé¦–ï¼‰ã€Aï¼ˆè¡Œå°¾ï¼‰

    * åå‘æ“ä½œï¼šF/Tã€P æ˜¯å…¶å°å†™ç‰ˆæœ¬çš„åæ–¹å‘

    * å¢å¼ºèŒƒå›´ï¼šC/D/Y æ˜¯ä½œç”¨åˆ°è¡Œå°¾çš„ç‰ˆæœ¬

    è¿™äº›å¤§å†™å‘½ä»¤è®© Vim çš„æ“ä½œæ›´åŠ é«˜æ•ˆï¼Œå‡å°‘äº†æ¨¡å¼åˆ‡æ¢å’Œé‡å¤æŒ‰é”®çš„éœ€è¦ã€‚

* å…³äº vim ä¸­`:s/foo/bar<CR>`çš„è§£ææœºåˆ¶

    Vim ä¸ä¼šæŠŠ :s/foo/bar<CR> è§£æä¸º "æŠŠ foo æ›¿æ¢ä¸º bar<CR>"ï¼ŒåŸå› å¦‚ä¸‹ï¼š

    Vim çš„å‘½ä»¤è¡Œè§£ææœºåˆ¶:

    * <CR> æ˜¯ç‰¹æ®Šçš„æ§åˆ¶å­—ç¬¦

    * åœ¨ Vim çš„å‘½ä»¤è¡Œæ¨¡å¼ä¸‹ï¼Œ<CR> è¡¨ç¤º å›è½¦æ‰§è¡Œ

    * å®ƒä¸æ˜¯æ™®é€šæ–‡æœ¬å­—ç¬¦ï¼Œè€Œæ˜¯ å‘½ä»¤ç»“æŸç¬¦

    * å½“ Vim é‡åˆ° <CR> æ—¶ï¼Œå®ƒä¼šç«‹å³ï¼š

        * ç»“æŸå½“å‰å‘½ä»¤çš„è¾“å…¥

        * è§£æå·²è¾“å…¥çš„å†…å®¹

        * æ‰§è¡Œè§£æåçš„å‘½ä»¤

    * è¾“å…¥`<cr>`å­—ç¬¦ä¸²éœ€è¦è½¬ä¹‰ï¼š`:s/foo/bar\<CR>/g`

        æ³¨æ„ï¼š

        1. åªéœ€è¦è½¬ä¹‰å·¦å°–æ‹¬å·å°±å¯ä»¥äº†ï¼Œè¶³ä»¥ç ´ååŸä¹‰

        1. åœ¨æ˜ å°„ä¸­è¦åŒé‡è½¬ä¹‰ï¼š

            ```vim
            " å¦‚æœåœ¨æ˜ å°„å®šä¹‰ä¸­ï¼š
            nnoremap <leader>x :s/foo/bar\\<CR>/g<CR>
            " éœ€è¦ \\ å› ä¸ºæ˜ å°„æœ¬èº«ä¼šè§£æä¸€æ¬¡
            ```

        1. ä½¿ç”¨è¡¨è¾¾å¼å¯„å­˜å™¨æ›´å®‰å…¨ï¼š

            ```vim
            :s/foo/\='bar<CR>'/g
            " åœ¨è¡¨è¾¾å¼ä¸­ï¼Œå­—ç¬¦ä¸²å­—é¢é‡ä¸éœ€è¦è½¬ä¹‰ç‰¹æ®Šé”®å
            ```

    * å¦‚æœè¦è¾“å…¥æ¢è¡Œï¼Œå¯ä»¥ä½¿ç”¨`\r`

        ```vim
        " å°† foo æ›¿æ¢ä¸º bar + å›è½¦ + æ¢è¡Œ
        :s/foo/bar\r/g

        " æ•ˆæœï¼šå°† "foo" æ›¿æ¢ä¸ºï¼š
        " bar
        " ï¼ˆåé¢å†…å®¹åœ¨æ–°è¡Œï¼‰
        ```

        ä¹Ÿå¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼å¯„å­˜å™¨:

        ```vim
        " ä½¿ç”¨ Ctrl-V + Enter è¾“å…¥çœŸæ­£çš„å›è½¦ç¬¦
        :s/foo/bar^M/g
        " ^M çš„è¾“å…¥æ–¹æ³•ï¼šåœ¨ replacement éƒ¨åˆ†æŒ‰ Ctrl-V ç„¶åæŒ‰ Enter

        " æˆ–è€…ä½¿ç”¨è¡¨è¾¾å¼ï¼š
        :s/foo/\="bar" . nr2char(13)/g
        ```

    * é‡è¦åŒºåˆ«ï¼š\r vs \n

        ```vim
        " \r åœ¨ replacement ä¸­è¡¨ç¤ºæ¢è¡Œç¬¦
        " \n åœ¨ pattern ä¸­è¡¨ç¤ºæ¢è¡Œç¬¦ï¼Œåœ¨ replacement ä¸­è¡¨ç¤º NUL å­—ç¬¦ï¼ˆASCII 0ï¼‰

        :s/foo/bar\n/g    " é”™è¯¯ï¼šä¼šæ’å…¥ NUL å­—ç¬¦ï¼ˆæ˜¾ç¤ºä¸º ^@ï¼‰
        :s/foo/bar\r/g    " æ­£ç¡®ï¼šæ’å…¥æ¢è¡Œç¬¦
        ```

    æ³¨æ„äº‹é¡¹

    * \r åœ¨æœç´¢æ¨¡å¼ä¸­è¡¨ç¤ºå›è½¦ï¼ˆ^Mï¼‰ï¼Œåœ¨æ›¿æ¢æ–‡æœ¬ä¸­è¡¨ç¤ºæ¢è¡Œ

    * å¦‚æœè¦æ›¿æ¢ä¸ºçœŸæ­£çš„ ^M å­—ç¬¦ï¼ˆCRï¼‰ï¼Œéœ€è¦ç”¨ \x0d æˆ–è¡¨è¾¾å¼å¯„å­˜å™¨

    * æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦è®¾ç½® :set ff=unix ç¡®ä¿æ¢è¡Œç¬¦æ­£ç¡®

* normal å‘½ä»¤

    ```vim
    :normal I* <CR>
    ```

    * :normal æ˜¯ä¸€ä¸ª Ex å‘½ä»¤ï¼ˆåœ¨ : å‘½ä»¤è¡Œä¸­æ‰§è¡Œï¼‰

    * å®ƒå‘Šè¯‰ Vimï¼š"åœ¨æ™®é€šæ¨¡å¼ä¸‹æ‰§è¡Œåé¢çš„æŒ‰é”®åºåˆ—"

    * I* æ˜¯ä¼ é€’ç»™ :normal çš„å‚æ•°

    * æœ€åçš„ <CR> æ˜¯ç»“æŸ :normal å‘½ä»¤ï¼Œè€Œä¸æ˜¯åœ¨æ™®é€šæ¨¡å¼ä¸­æŒ‰å›è½¦

    æ‰§è¡Œæµç¨‹è§£æ

    ```vim
    :g/^\s*\S/normal I* <CR>
    ```

    * : è¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼

    * g/^\s*\S/ è®¾ç½®åŒ¹é…æ¨¡å¼

    * normal I* å¯¹åŒ¹é…çš„æ¯è¡Œæ‰§è¡Œæ™®é€šæ¨¡å¼å‘½ä»¤ I*â£

    * <CR> æ‰§è¡Œæ•´ä¸ª :g å‘½ä»¤

    è¿™é‡Œçš„ <CR> ä¸æ˜¯ç»™ normal I* çš„ï¼Œè€Œæ˜¯ç»“æŸ :g å‘½ä»¤å¹¶æ‰§è¡Œå®ƒã€‚

* matlab `reshape()`

    reshape() æ˜¯ MATLAB ä¸­ç”¨äºæ”¹å˜æ•°ç»„ç»´åº¦è€Œä¸æ”¹å˜æ•°æ®æ€»é‡çš„æ ¸å¿ƒå‡½æ•°ã€‚

    1. å‡½æ•°åŸå‹

        ```matlab
        B = reshape(A, sz)
        B = reshape(A, sz1, sz2, ..., szN)
        ```

        * A: è¾“å…¥æ•°ç»„ï¼ˆä»»æ„ç»´åº¦ï¼‰

        * sz: æ–°ç»´åº¦å¤§å°çš„å‘é‡ï¼Œå¦‚ [m, n, p, ...]

        * sz1, sz2, ..., szN: å„ç»´åº¦çš„å…·ä½“å¤§å°

        * B: é‡å¡‘åçš„è¾“å‡ºæ•°ç»„

    2. æ ¸å¿ƒä½œç”¨

        é‡æ–°æ’åˆ—æ•°ç»„çš„ç»´åº¦å¸ƒå±€ï¼Œä¿æŒå…ƒç´ æ€»æ•°ä¸å˜ï¼ˆå³ numel(A) == numel(B)ï¼‰ã€‚

    3. åŸºæœ¬ç”¨æ³•ç¤ºä¾‹

        ç¤ºä¾‹1ï¼šçŸ©é˜µç»´åº¦è½¬æ¢

        ```matlab
        A = 1:12;            % 1Ã—12 è¡Œå‘é‡
        B = reshape(A, 3, 4) % é‡å¡‘ä¸º 3Ã—4 çŸ©é˜µ
        % B = 
        %    1    4    7   10
        %    2    5    8   11
        %    3    6    9   12
        ```

        ç¤ºä¾‹2ï¼šå¤šç»´åº¦æ•°ç»„

        ```matlab
        A = 1:24;
        B = reshape(A, [2, 3, 4])  % ä¸‰ç»´æ•°ç»„ï¼š2Ã—3Ã—4
        ```

        ç¤ºä¾‹3ï¼šè‡ªåŠ¨æ¨æ–­ç»´åº¦

        ```matlab
        A = rand(4, 6);           % 4Ã—6 çŸ©é˜µ
        B = reshape(A, 3, [])     % 3Ã—8 çŸ©é˜µï¼ˆè‡ªåŠ¨è®¡ç®—ç¬¬äºŒç»´ä¸º8ï¼‰
        ```

    4. å…³é”®ç‰¹æ€§

        4.1 æŒ‰åˆ—ä¼˜å…ˆé¡ºåº

        MATLAB æŒ‰åˆ—ä¼˜å…ˆï¼ˆcolumn-majorï¼‰é¡ºåºé‡å¡‘ï¼š

        ```matlab
        A = [1 2 3; 4 5 6];  % 2Ã—3 çŸ©é˜µ
        % A = 
        %     1  2  3
        %     4  5  6

        B = reshape(A, 3, 2)
        % B = 
        %     1  3  5
        %     2  4  6
        % æŒ‰åˆ—è¯»å–ï¼š1â†’4â†’2â†’5â†’3â†’6
        ```

        4.2 ä¿æŒå…ƒç´ æ€»æ•°ä¸å˜

        ```matlab
        A = rand(5, 7);
        % numel(A) = 35ï¼Œæ–°ç»´åº¦ä¹˜ç§¯å¿…é¡»ä¸º35
        B = reshape(A, 7, 5);    % âˆš 7Ã—5=35
        % C = reshape(A, 6, 6);  % Ã— ä¼šæŠ¥é”™ï¼š6Ã—6â‰ 35
        ```

        4.3 ä¸è½¬ç½®çš„åŒºåˆ«

        ```matlab
        A = [1 2 3; 4 5 6];
        B1 = reshape(A, 3, 2)   % æ”¹å˜æ•°æ®å¸ƒå±€
        B2 = A'                 % è½¬ç½®ï¼šè¡Œåˆ—äº¤æ¢
        % B1 = [1 3 5; 2 4 6]
        % B2 = [1 4; 2 5; 3 6]
        ```

    5. å®ç”¨æŠ€å·§

        5.1 å‘é‡åŒ–çŸ©é˜µ

        ```matlab
        A = magic(3);
        v = reshape(A, [], 1)   % å±•æˆåˆ—å‘é‡ï¼Œç­‰ä»·äº A(:)
        ```

        5.2 æ‰¹é‡å›¾åƒå¤„ç†

        ```matlab
        % å°†å¤šä¸ª 28Ã—28 å›¾åƒå±•å¹³ä¸ºå‘é‡
        images = rand(28, 28, 1000);      % 1000å¼ ç°åº¦å›¾
        flattened = reshape(images, 784, 1000);  % 784Ã—1000
        ```

        5.3 ç»´åº¦é¡ºåºè°ƒæ•´ï¼ˆç»“åˆ permuteï¼‰

        ```matlab
        % å°†é€šé“æ•°æ”¾åœ¨ç¬¬ä¸‰ç»´ï¼ˆé€‚åˆå›¾åƒå¤„ç†ï¼‰
        data = rand(224, 224, 3, 100);  % 100å¼ RGBå›¾åƒ
        data_reshaped = reshape(data, 224, 224, 3, 100);
        ```

    6. å¸¸è§åº”ç”¨åœºæ™¯

        * æ•°æ®é¢„å¤„ç†ï¼šç»Ÿä¸€è¾“å…¥ç»´åº¦

        * çŸ©é˜µè¿ç®—ï¼šæ”¹å˜å½¢çŠ¶ä»¥é€‚åº”ç®—æ³•è¦æ±‚

        * å›¾åƒå¤„ç†ï¼šå±•å¹³å›¾åƒä¸ºç‰¹å¾å‘é‡

        * ç¥ç»ç½‘ç»œï¼šè°ƒæ•´æ•°æ®ç»´åº¦ä»¥é€‚åº”ç½‘ç»œå±‚

    æ³¨æ„äº‹é¡¹

    * reshape ä¸æ”¹å˜å†…å­˜ä¸­çš„æ•°æ®é¡ºåºï¼Œä»…æ”¹å˜ç´¢å¼•æ–¹å¼

    * æ–°ç»´åº¦çš„å…ƒç´ æ€»æ•°å¿…é¡»ä¸åŸæ•°ç»„ç›¸åŒ

    * ä¸ squeeze() ç»“åˆå¯å»é™¤å•ä¸€ç»´åº¦ï¼šreshape(squeeze(A), ...)

    * é«˜ç»´æ•°ç»„é‡å¡‘æ—¶ï¼Œå»ºè®®ç”¨å‘é‡å½¢å¼ [dim1, dim2, ...] æé«˜å¯è¯»æ€§

* matlab `dir()`

    dir() æ˜¯ MATLAB ä¸­ç”¨äºè·å–ç›®å½•å†…å®¹ä¿¡æ¯çš„æ ¸å¿ƒå‡½æ•°ã€‚

    1. å‡½æ•°åŸå‹

        ```matlab
        files = dir
        files = dir(name)
        ```

        * æ— è¾“å…¥å‚æ•°: è·å–å½“å‰ç›®å½•å†…å®¹

        * name: æŒ‡å®šç›®å½•è·¯å¾„æˆ–æ–‡ä»¶é€šé…ç¬¦

        * files: è¿”å›ç»“æ„ä½“æ•°ç»„ï¼ŒåŒ…å«æ–‡ä»¶/æ–‡ä»¶å¤¹ä¿¡æ¯

    2. æ ¸å¿ƒä½œç”¨

        åˆ—å‡ºç›®å½•ä¸­çš„æ–‡ä»¶å’Œå­ç›®å½•ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡ä»¶åã€æ—¥æœŸã€å¤§å°ã€æ˜¯å¦ç›®å½•ç­‰å±æ€§ã€‚

    3. è¾“å‡ºç»“æ„ä½“å­—æ®µ

        ```matlab
        files = dir;
        % æ¯ä¸ªå…ƒç´ åŒ…å«ä»¥ä¸‹å­—æ®µï¼š
        files(1).name      % æ–‡ä»¶/æ–‡ä»¶å¤¹åç§°ï¼ˆå­—ç¬¦ä¸²ï¼‰
        files(1).folder    % æ‰€åœ¨æ–‡ä»¶å¤¹å®Œæ•´è·¯å¾„ï¼ˆå­—ç¬¦ä¸²ï¼‰
        files(1).date      % ä¿®æ”¹æ—¥æœŸæ—¶é—´ï¼ˆå­—ç¬¦ä¸²ï¼‰
        files(1).bytes     % æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰
        files(1).isdir     % æ˜¯å¦ä¸ºç›®å½•ï¼ˆé€»è¾‘å€¼ï¼š1=æ˜¯ï¼Œ0=å¦ï¼‰
        files(1).datenum   % æ—¥æœŸåºåˆ—å·ï¼ˆå¯ç”¨äºæ’åºï¼‰
        ```

    4. åŸºæœ¬ç”¨æ³•ç¤ºä¾‹

        ç¤ºä¾‹1ï¼šåˆ—å‡ºå½“å‰ç›®å½•æ‰€æœ‰å†…å®¹

        ```matlab
        files = dir;  % è·å–å½“å‰ç›®å½•å†…å®¹
        disp(files)   % æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹
        ```

        ç¤ºä¾‹2ï¼šåˆ—å‡ºæŒ‡å®šç›®å½•

        ```matlab
        % åˆ—å‡ºç‰¹å®šç›®å½•
        files = dir('C:\Users\Documents\MATLAB');

        % åˆ—å‡ºå½“å‰ç›®å½•çš„å­ç›®å½•
        files = dir('./data');
        ```

        ç¤ºä¾‹3ï¼šä½¿ç”¨é€šé…ç¬¦è¿‡æ»¤

        ```matlab
        % æ‰€æœ‰ .m æ–‡ä»¶
        m_files = dir('*.m');

        % æ‰€æœ‰ä»¥ test å¼€å¤´çš„æ–‡ä»¶
        test_files = dir('test*');

        % ç‰¹å®šæ‰©å±•å
        csv_files = dir('*.csv');

        % å­ç›®å½•ä¸­çš„ç‰¹å®šæ–‡ä»¶
        data_files = dir('data/*.mat');
        ```

        ç¤ºä¾‹4ï¼šè·å–æ–‡ä»¶è¯¦ç»†ä¿¡æ¯

        ```matlab
        files = dir('*.mat');
        for i = 1:length(files)
            fprintf('æ–‡ä»¶å: %s\n', files(i).name);
            fprintf('å¤§å°: %.2f KB\n', files(i).bytes/1024);
            fprintf('ä¿®æ”¹æ—¥æœŸ: %s\n', files(i).date);
            fprintf('æ˜¯å¦ä¸ºç›®å½•: %d\n', files(i).isdir);
            fprintf('---\n');
        end
        ```

    5. å®ç”¨æŠ€å·§ä¸å¸¸è§æ“ä½œ

        5.1 è¿‡æ»¤æ‰ "." å’Œ ".." ç›®å½•

        ```matlab
        files = dir;
        % å»é™¤å½“å‰ç›®å½•(.)å’Œçˆ¶ç›®å½•(..)
        files = files(~ismember({files.name}, {'.', '..'}));

        % æˆ–è€…åªä¿ç•™æ–‡ä»¶ï¼ˆæ’é™¤ç›®å½•ï¼‰
        files = dir;
        files = files(~[files.isdir]);  % åªä¿ç•™æ–‡ä»¶
        ```

        5.2 æŒ‰ç‰¹å®šæ¡ä»¶ç­›é€‰æ–‡ä»¶

        ```matlab
        % æŒ‰æ—¥æœŸç­›é€‰ï¼ˆæœ€è¿‘7å¤©å†…ä¿®æ”¹çš„ï¼‰
        files = dir('*.m');
        file_dates = [files.datenum];
        recent_idx = file_dates > (now - 7);
        recent_files = files(recent_idx);

        % æŒ‰å¤§å°ç­›é€‰ï¼ˆå¤§äº1MBçš„æ–‡ä»¶ï¼‰
        files = dir('*.mat');
        large_files = files([files.bytes] > 1024^2);
        ```

        5.3 æ–‡ä»¶æ’åº

        ```matlab
        files = dir('*.csv');
        % æŒ‰æ–‡ä»¶åæ’åº
        [~, idx] = sort({files.name});
        files = files(idx);

        % æŒ‰ä¿®æ”¹æ—¥æœŸæ’åºï¼ˆä»æ–°åˆ°æ—§ï¼‰
        [~, idx] = sort([files.datenum], 'descend');
        files = files(idx);

        % æŒ‰æ–‡ä»¶å¤§å°æ’åº
        [~, idx] = sort([files.bytes]);
        files = files(idx);
        ```

        5.4 é€’å½’è·å–æ‰€æœ‰å­ç›®å½•æ–‡ä»¶

        ```matlab
        function all_files = getAllFiles(dir_path)
            % è·å–ç›®å½•åŠæ‰€æœ‰å­ç›®å½•ä¸­çš„æ–‡ä»¶
            files = dir(dir_path);
            files = files(~ismember({files.name}, {'.', '..'}));
            
            all_files = {};
            
            for i = 1:length(files)
                file_path = fullfile(files(i).folder, files(i).name);
                
                if files(i).isdir
                    % é€’å½’å¤„ç†å­ç›®å½•
                    sub_files = getAllFiles(file_path);
                    all_files = [all_files; sub_files];
                else
                    % æ·»åŠ æ–‡ä»¶
                    all_files = [all_files; {file_path}];
                end
            end
        end
        ```

        5.5 æ‰¹é‡å¤„ç†æ–‡ä»¶

        ```matlab
        % æ‰¹é‡è¯»å–å’Œå¤„ç†å›¾åƒ
        image_files = dir('images/*.jpg');
        for i = 1:length(image_files)
            filename = fullfile(image_files(i).folder, image_files(i).name);
            img = imread(filename);
            % å¤„ç†å›¾åƒ...
        end
        ```

        5.6 ä¸ fullfile() ç»“åˆä½¿ç”¨

        ```matlab
        files = dir('data/*.txt');
        for i = 1:length(files)
            % æ„å»ºå®Œæ•´æ–‡ä»¶è·¯å¾„
            full_path = fullfile(files(i).folder, files(i).name);
            
            % è¯»å–æ–‡ä»¶
            data = readtable(full_path);
            % å¤„ç†æ•°æ®...
        end
        ```

    6. æ³¨æ„äº‹é¡¹

        * éšè—æ–‡ä»¶ï¼šdir ä¼šæ˜¾ç¤ºéšè—æ–‡ä»¶ï¼ˆå¦‚ .gitignoreï¼‰

        * æ€§èƒ½è€ƒè™‘ï¼šå¤„ç†å¤§é‡æ–‡ä»¶æ—¶ï¼Œè€ƒè™‘ä½¿ç”¨é€šé…ç¬¦è¿‡æ»¤

        * è·¯å¾„åˆ†éš”ç¬¦ï¼šä½¿ç”¨ fullfile() å¤„ç†è·¨å¹³å°è·¯å¾„é—®é¢˜

        * ç¬¦å·é“¾æ¥ï¼šä¼šè¿”å›ç¬¦å·é“¾æ¥æœ¬èº«çš„ä¿¡æ¯

        * ç©ºç›®å½•ï¼šç©ºç›®å½•è¿”å›ç©ºçš„ç»“æ„ä½“æ•°ç»„

    7. å¸¸è§åº”ç”¨åœºæ™¯

        * æ•°æ®æ‰¹é‡å¯¼å…¥ï¼šè¯»å–ç›®å½•ä¸­æ‰€æœ‰æ•°æ®æ–‡ä»¶

        * æ–‡ä»¶ç®¡ç†ï¼šæŸ¥æ‰¾ã€ç­›é€‰ã€ç»„ç»‡æ–‡ä»¶

        * è‡ªåŠ¨åŒ–å¤„ç†ï¼šæ‰¹é‡å¤„ç†å›¾åƒã€æ–‡æœ¬ç­‰æ–‡ä»¶

        * é¡¹ç›®ç»“æ„åˆ†æï¼šè·å–é¡¹ç›®æ–‡ä»¶åˆ—è¡¨

    8. ç›¸å…³å‡½æ•°

        * ls: ç®€å•åˆ—å‡ºæ–‡ä»¶åï¼ˆè¿”å›å­—ç¬¦æ•°ç»„ï¼‰

        * what: åˆ—å‡ºMATLABç‰¹å®šæ–‡ä»¶ï¼ˆ.m, .mat, .mlxç­‰ï¼‰

        * exist: æ£€æŸ¥æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨

        * cd: æ›´æ”¹å½“å‰ç›®å½•

        * pwd: æ˜¾ç¤ºå½“å‰ç›®å½•

* dma_sync_single_for_device(), dma_sync_single_for_cpu()

    1. å‡½æ•°åŸå‹

        ```c
        // åŒæ­¥DMAç¼“å†²åŒºç»™è®¾å¤‡ä½¿ç”¨
        void dma_sync_single_for_device(struct device *dev, 
                                       dma_addr_t addr,
                                       size_t size,
                                       enum dma_data_direction dir);

        // åŒæ­¥DMAç¼“å†²åŒºç»™CPUä½¿ç”¨
        void dma_sync_single_for_cpu(struct device *dev,
                                    dma_addr_t addr,
                                    size_t size,
                                    enum dma_data_direction dir);
        ```

    2. ä½œç”¨

        dma_sync_single_for_device()

        * ç›®çš„ï¼šç¡®ä¿è®¾å¤‡èƒ½çœ‹åˆ°CPUå¯¹DMAç¼“å†²åŒºçš„æœ€æ–°ä¿®æ”¹

        * å®é™…è¡Œä¸ºï¼š

            * å°†CPUçš„cacheåˆ·å†™åˆ°å†…å­˜ï¼ˆå¦‚æœCPUä¿®æ”¹äº†æ•°æ®ï¼‰

            * è®©è®¾å¤‡è®¿é—®çš„å†…å­˜åŒºåŸŸä¿æŒä¸€è‡´

            * ä½¿è®¾å¤‡èƒ½è¯»å–åˆ°CPUå†™å…¥çš„æ•°æ®

        dma_sync_single_for_cpu()

        * ç›®çš„ï¼šç¡®ä¿CPUèƒ½çœ‹åˆ°è®¾å¤‡å¯¹DMAç¼“å†²åŒºçš„æœ€æ–°ä¿®æ”¹

        * å®é™…è¡Œä¸ºï¼š

            * ä½¿CPUçš„cacheå¤±æ•ˆï¼ˆå¦‚æœè®¾å¤‡ä¿®æ”¹äº†æ•°æ®ï¼‰

            * ç¡®ä¿CPUè¯»å–çš„æ˜¯å†…å­˜ä¸­çš„æœ€æ–°æ•°æ®

            * ä½¿CPUèƒ½è¯»å–åˆ°è®¾å¤‡å†™å…¥çš„æ•°æ®

    3. ç”¨æ³•

        å…¸å‹ä½¿ç”¨åœºæ™¯

        ```c
        #include <linux/dma-mapping.h>

        struct device *dev;      // è®¾å¤‡æŒ‡é’ˆ
        dma_addr_t dma_handle;   // DMAç¼“å†²åŒºæ€»çº¿åœ°å€
        void *cpu_addr;          // CPUè®¿é—®çš„è™šæ‹Ÿåœ°å€
        size_t size = 4096;      // ç¼“å†²åŒºå¤§å°

        // åœºæ™¯1: CPUå‡†å¤‡æ•°æ®ï¼Œè®¾å¤‡è¯»å–
        void prepare_data_for_device(void)
        {
            // 1. CPUå†™å…¥æ•°æ®åˆ°ç¼“å†²åŒº
            memset(cpu_addr, 0xAA, size);
            
            // 2. åŒæ­¥ç»™è®¾å¤‡ï¼ˆç¡®ä¿è®¾å¤‡èƒ½çœ‹åˆ°CPUçš„å†™å…¥ï¼‰
            dma_sync_single_for_device(dev, dma_handle, size, DMA_TO_DEVICE);
            
            // 3. å¯åŠ¨è®¾å¤‡DMAè¯»å–æ“ä½œ
            start_device_dma_read(dma_handle);
        }

        // åœºæ™¯2: è®¾å¤‡å†™å…¥æ•°æ®ï¼ŒCPUè¯»å–
        void read_data_from_device(void)
        {
            // 1. å¯åŠ¨è®¾å¤‡DMAå†™å…¥æ“ä½œ
            start_device_dma_write(dma_handle);
            
            // 2. ç­‰å¾…è®¾å¤‡å®Œæˆï¼ˆä¸­æ–­æˆ–è½®è¯¢ï¼‰
            wait_for_device_completion();
            
            // 3. åŒæ­¥ç»™CPUï¼ˆä½¿CPUèƒ½çœ‹åˆ°è®¾å¤‡çš„å†™å…¥ï¼‰
            dma_sync_single_for_cpu(dev, dma_handle, size, DMA_FROM_DEVICE);
            
            // 4. CPUè¯»å–è®¾å¤‡å†™å…¥çš„æ•°æ®
            process_data(cpu_addr);
        }

        // åœºæ™¯3: åŒå‘ä¼ è¾“ï¼ˆDMA_BIDIRECTIONALï¼‰
        void bidirectional_transfer(void)
        {
            // è®¾å¤‡å¯èƒ½è¯»å†™ï¼ŒCPUä¹Ÿå¯èƒ½è¯»å†™
            dma_sync_single_for_device(dev, dma_handle, size, DMA_BIDIRECTIONAL);
            // ... æ“ä½œ ...
            dma_sync_single_for_cpu(dev, dma_handle, size, DMA_BIDIRECTIONAL);
        }
        ```

        æ•°æ®æ–¹å‘å‚æ•°

        ```c
        enum dma_data_direction {
            DMA_BIDIRECTIONAL = 0,    // åŒå‘
            DMA_TO_DEVICE = 1,        // CPU â†’ è®¾å¤‡
            DMA_FROM_DEVICE = 2,      // è®¾å¤‡ â†’ CPU
            DMA_NONE = 3,             // è°ƒè¯•ç”¨
        };
        ```

    4. é‡è¦æ³¨æ„äº‹é¡¹

        * å¯¹ç§°è°ƒç”¨ï¼š

            * å¦‚æœä½¿ç”¨äº† for_device()ï¼Œä¹‹åå¿…é¡»ä½¿ç”¨å¯¹åº”çš„ for_cpu()

            * æ–¹å‘å‚æ•°å¿…é¡»ä¸€è‡´

        * æ€§èƒ½å½±å“ï¼š

            * è¿™äº›å‡½æ•°æ¶‰åŠcacheæ“ä½œï¼Œå¼€é”€è¾ƒå¤§

            * åº”å°½é‡å‡å°‘è°ƒç”¨æ¬¡æ•°

        * æ›¿ä»£æ–¹æ¡ˆï¼š

            ```c
            // ä½¿ç”¨æµå¼DMAæ˜ å°„ï¼ˆä¸€æ¬¡æ€§çš„ï¼Œé€šå¸¸æ€§èƒ½æ›´å¥½ï¼‰
            dma_map_single(dev, cpu_addr, size, dir);
            // ... DMAæ“ä½œ ...
            dma_unmap_single(dev, dma_handle, size, dir);
            ```

        * å¹³å°ç›¸å…³æ€§ï¼š

            * åœ¨x86ç­‰å¼ºä¸€è‡´æ¶æ„ä¸Šå¯èƒ½æ˜¯ç©ºæ“ä½œ

            * åœ¨ARMã€PowerPCç­‰å¼±ä¸€è‡´æ¶æ„ä¸Šæ˜¯å¿…è¦çš„

    5. å…¸å‹é©±åŠ¨ä»£ç ç»“æ„

        ```c
        static int my_driver_probe(struct device *dev)
        {
            // åˆ†é…DMAç¼“å†²åŒº
            cpu_addr = dma_alloc_coherent(dev, size, &dma_handle, GFP_KERNEL);
            
            // æˆ–è€…ä½¿ç”¨æµå¼æ˜ å°„
            // dma_handle = dma_map_single(dev, cpu_addr, size, direction);
        }

        static void my_driver_io(struct device *dev)
        {
            // å‡†å¤‡å‘é€æ•°æ®
            fill_transmit_buffer(cpu_addr);
            dma_sync_single_for_device(dev, dma_handle, size, DMA_TO_DEVICE);
            
            // å¯åŠ¨è®¾å¤‡ä¼ è¾“
            program_device_dma(dma_handle);
            
            // æ¥æ”¶æ•°æ®æ—¶
            dma_sync_single_for_cpu(dev, dma_handle, size, DMA_FROM_DEVICE);
            process_received_data(cpu_addr);
        }
        ```

    è¿™äº›å‡½æ•°æ˜¯Linuxå†…æ ¸DMA APIçš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œç¡®ä¿åœ¨éä¸€è‡´æ€§å†…å­˜æ¶æ„ä¸Šï¼ŒCPUå’Œè®¾å¤‡èƒ½çœ‹åˆ°å½¼æ­¤å¯¹å…±äº«å†…å­˜çš„æœ€æ–°ä¿®æ”¹ã€‚

* åœ¨ bash ä¸­ï¼Œåˆ†å· ; çš„ä¸»è¦ä½œç”¨æ˜¯åˆ†éš”å¤šä¸ªå‘½ä»¤ï¼Œç±»ä¼¼äºæ¢è¡Œã€‚å®ƒå‘Šè¯‰ shell åœ¨åˆ†å·å‰ä¸€ä¸ªå‘½ä»¤ç»“æŸåï¼Œç«‹å³æ‰§è¡Œåˆ†å·åçš„ä¸‹ä¸€ä¸ªå‘½ä»¤ã€‚

    æ¯”å¦‚`export LD_LIBRARY_PATH=/path/to/libs; bash run_main.sh`ç­‰ä»·äºï¼š

    ```bash
    export LD_LIBRARY_PATH=/path/to/libs
    bash run_main.sh
    ```

    éœ€è¦æ³¨æ„åˆ†å·å’Œ && çš„åŒºåˆ«ï¼š

    * åˆ†å· ;ï¼šæ— è®ºå‰ä¸€ä¸ªå‘½ä»¤æ˜¯å¦æˆåŠŸï¼Œéƒ½ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªå‘½ä»¤

        ```bash
        false; echo "è¿™ä¸ªä¼šæ‰§è¡Œ"  # echo å‘½ä»¤ä¸€å®šä¼šæ‰§è¡Œ
        ```

    * é€»è¾‘ä¸ &&ï¼šåªæœ‰å‰ä¸€ä¸ªå‘½ä»¤æˆåŠŸï¼ˆè¿”å› 0ï¼‰ï¼Œæ‰æ‰§è¡Œä¸‹ä¸€ä¸ªå‘½ä»¤

        ```bash
        false && echo "è¿™ä¸ªä¸ä¼šæ‰§è¡Œ"  # echo ä¸ä¼šæ‰§è¡Œ
        true && echo "è¿™ä¸ªä¼šæ‰§è¡Œ"     # echo ä¼šæ‰§è¡Œ
        ```
