* sudo 与环境变量的关系

    sudo 应该写在环境变量的前面。
    
    example:

    `sudo http_proxy=http://127.0.0.1:8822 https_proxy=http://127,0,0,1:8822 apt update`

* bash 中的 trap 可以让用户指定函数或命令去处理 signal 信号

    example:

    `main.sh`:

    ```bash
    trap "echo manully terminated!; exit 1" INT

    while true; do
        echo "current time: $(date)"
        sleep 1
    done
    ```

    执行：`bash ./main.sh`，等待几秒后，按`Ctrl` + `C`。

    output:

    ```
    current time: 2025年 06月 30日 星期一 13:03:09 CST
    current time: 2025年 06月 30日 星期一 13:03:10 CST
    current time: 2025年 06月 30日 星期一 13:03:11 CST
    current time: 2025年 06月 30日 星期一 13:03:12 CST
    ^Cmanully terminated!
    ```

* 长短任务的双向分支

    如果一个长线任务因为各种原因暂停，那么当前 work space 环境必须可以快速切换到另一个 branch 开始短线能完成的任务。

    目前采用的方案是 ubuntu gnome 下，以 personal log 为中心虚拟桌面，向右创建新桌面是长线任务，向左创建新桌面是短线任务。

    如果在长线任务的右边再创建新桌面用于短线任务，那么短线任务和 personal log 切换的时间就延长了许多，效率会变低。`root -> stack 1 -> stack 2`，我们可以认为长线任务为 stack 1，短线任务为 stack 2，由此可以看出 root 和 stack 2 之间的距离太长。但是如果换成`stack 2 <- root -> stack 1`，这样的形式就好多了。

    这个 topic 有两个要点，一个是有一个长线任务时，只能派生一个短线任务，不能让任务多级嵌套，比如发现 task 1 blocked 的时候，去执行 task 2，而 task 2 被 blocked 时，去执行 task 3 ... 此时如果 task 1 可以恢复执行，那么 task 2，task 3 ... 的调度全都乱了。因此长线任务一个，短线任务也只保持一个，是最好的。

    另一个要点是分支时，root 节点和每个 task 节点的切换效率必须要高，要求`task 1 <--> root`和`root <--> task 2`的效率都必须高，但是不要求`task 1 <--> task 2`的效率高。

    如果能实现这样的工作环境，那么就有可能实现异步高效的任务执行。

* bash 中常见信号与触发条件

    | 信号名称 | 编号 |	触发条件 |
    | - | - | - |
    | `INT` | 2 | Ctrl + C 中断 |
    | `TERM` | 15 | 默认的 kill 命令 |
    | `EXIT` | 0 | 脚本退出时（非真实信号） |
    | `ERR` | - | 命令执行失败时（非真实信号） |
    | `DEBUG` | - | 每条命令执行后（非真实信号） |

    example:

    `main.sh`：

    ```bash
    trap "echo INT triggered!; exit 1" INT
    trap "echo TERM triggered; exit 1" TERM
    trap "echo EXIT triggered; exit 1" EXIT
    trap "echo ERR triggered; exit 1" ERR
    trap "echo DEBUG triggered" DEBUG

    while true; do
        echo "current time: $(date)"
        sleep 1
    done
    ```

    run: `bash main.sh`

    使用不同的方式触发 signal 后，output 如下：

    * `Ctrl` + `C`

        ```
        DEBUG triggered
        DEBUG triggered
        current time: 2025年 07月 01日 星期二 15:41:38 CST
        DEBUG triggered
        DEBUG triggered
        DEBUG triggered
        current time: 2025年 07月 01日 星期二 15:41:39 CST
        DEBUG triggered
        DEBUG triggered
        DEBUG triggered
        current time: 2025年 07月 01日 星期二 15:41:40 CST
        DEBUG triggered
        ^CDEBUG triggered
        INT triggered!
        DEBUG triggered
        DEBUG triggered
        EXIT triggered
        DEBUG triggered
        ```

    * kill

        ```
        DEBUG triggered
        DEBUG triggered
        current time: 2025年 07月 01日 星期二 15:44:15 CST
        DEBUG triggered
        DEBUG triggered
        DEBUG triggered
        current time: 2025年 07月 01日 星期二 15:44:16 CST
        DEBUG triggered
        DEBUG triggered
        DEBUG triggered
        current time: 2025年 07月 01日 星期二 15:44:17 CST
        DEBUG triggered
        DEBUG triggered
        TERM triggered
        DEBUG triggered
        DEBUG triggered
        EXIT triggered
        DEBUG triggered
        ```

    所有的信号对大小写不敏感，即`INT`和`int`是等价的，其他的同理。