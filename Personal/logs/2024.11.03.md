* openshmem 可以跑通的两种方式

    * 下载 openmpi 3.0 版本

        编译配置：

        `./configure --prefix=/root/openmpi-3.0.6/build --exec-prefix=/root/openmpi-3.0.6/bin --with-ucx`

        编译：

        `make -j8`

        编译安装：

        `make install`

        说明：

        1. 这里配置`prefix`是为了后面执行`make install`。只执行`make`不会编译出`xxx.so`之类的文件。

        2. `--with-ucx`表示使用本机系统自带的 ucx 进行编译。通常这个 ucx 是用 apt 安装的。

        编译 app:

        `./shmemcc ~/shmem_test/main.c -o main`

        运行：

        `./shmemrun --allow-run-as-root -np 4 ./main`

        此时即可获得稳定输出：

        ```
        Hello from 1 of 4
        Hello from 2 of 4
        Hello from 3 of 4
        Hello from 0 of 4
        ```

    * 下载 openmpi 5.0 版本

        此时如果使用系统自带的 ucx 会报错，提示必须使用 1.9 及以上版本的 ucx。可以去 github <https://github.com/openucx/ucx> 找到最新版 ucx。

        openmpi 编译配置：

        ```bash
        ./configure --prefix=/home/hlc/Downloads/openmpi_505/openmpi-5.0.5/build --exec-prefix=/home/hlc/Downloads/openmpi_505/openmpi-5.0.5/bin --enable-oshmem --enable-oshmem-compat --enable-oshmem-profile --with-oshmem-param-check --with-ucx=/home/hlc/Documents/Projects/ucx/build
        ```

        编译：

        `make -j8`

        编译安装：

        `make install`

        说明：

        1. 不写`--enable-oshmem --enable-oshmem-compat --enable-oshmem-profile --with-oshmem-param-check`有可能不编译完整的 openshmem，只编译出一个`oshrun`文件。

        2. `--with-ucx=/home/hlc/Documents/Projects/ucx/build`这里填的是我们自己编译的 ucx 目录。

        编译 app:

        `./shmemcc /home/hlc/Documents/Projects/shmem_test/main.c -o main`

        运行：

        `./oshrun -np 4 ./main`

        此时即可获得稳定输出：

        ```
        Hello from 1 of 4
        Hello from 3 of 4
        Hello from 2 of 4
        Hello from 0 of 4
        ```

        说明：

        1. `./oshrun -np 4 ./main`，注意编译出来的可执行文件已经没有`oshmemrun`了，只有`oshrun`。

* 猜测 apt 自带的 openshmem 不能跑通的原因是，apt 中的 openmpi 版本是 4.1，其在编译的时候，使用了比较新的 ucx 版本。但是 apt 的 ucx 版本仍然是比较旧的，导致出现错误。

* [ ] 调研 openmpi 对 mellanox, cuda, rocm 的支持

* docker 配置代理

    `/etc/systemd/system/docker.service.d/http-proxy.conf`:

    ```conf
    [Service]
    Environment="HTTP_PROXY=http://192.168.56.1:10809"
    Environment="HTTPS_PROXY=http://192.168.56.1:10809"
    ```

